<!DOCTYPE html>
<html lang="lo">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Luxe Money 2026 - Premium UI</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Lao:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root {
            --primary: #6366f1; --income: #10b981; --expense: #f43f5e;
            --bg: #0b0f1a; --card: rgba(23, 27, 44, 0.98);
            --glass: rgba(255, 255, 255, 0.05); --text: #ffffff; --sub: #94a3b8;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body {
            font-family: 'Noto Sans Lao', sans-serif; background-color: var(--bg);
            background-image: radial-gradient(circle at 0% 0%, #1e1b4b 0%, transparent 45%),
                              radial-gradient(circle at 100% 100%, #312e81 0%, transparent 45%);
            color: var(--text); margin: 0; padding: 0; height: 100dvh; display: flex; flex-direction: column; overflow: hidden;
        }

        /* --- PIN LOCK --- */
        #pin-screen { position: fixed; inset: 0; background: var(--bg); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .pin-dots { display: flex; gap: 20px; margin-bottom: 40px; }
        .pin-dot { width: 14px; height: 14px; border: 2px solid var(--primary); border-radius: 50%; }
        .pin-dot.active { background: var(--primary); box-shadow: 0 0 15px var(--primary); transform: scale(1.2); }
        .numpad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; width: 80%; max-width: 320px; }
        .num-btn { aspect-ratio: 1/1; border-radius: 50%; background: var(--glass); display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: 600; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); color: white; }

        .app-container { flex: 1; overflow-y: auto; padding: 0 20px 140px; width: 100%; max-width: 500px; margin: auto; }
        .sticky-filter { position: sticky; top: 0; z-index: 900; background: var(--bg); padding: 15px 0; }
        .header-card { background: var(--card); border: 1px solid rgba(255,255,255,0.1); border-radius: 30px; padding: 25px; margin-bottom: 20px; text-align: center; backdrop-filter: blur(15px); }
        .bal-val { font-size: 2.2rem; font-weight: 700; margin: 5px 0 15px; letter-spacing: -1px; }

        .glass-card { background: var(--card); border-radius: 24px; padding: 20px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1); }
        .card-header { font-weight: 700; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; font-size: 0.9rem; }

        .type-pill { display: flex; background: #000; padding: 4px; border-radius: 14px; margin-bottom: 15px; }
        .t-btn { flex: 1; padding: 12px; border: none; border-radius: 10px; background: transparent; color: var(--sub); font-weight: 700; font-family: inherit; cursor: pointer; }
        .t-btn.active-exp { background: var(--expense); color: white; }
        .t-btn.active-inc { background: var(--income); color: white; }

        input, select { width: 100%; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1); padding: 14px; border-radius: 12px; color: white; margin-bottom: 8px; font-size: 16px; font-family: inherit; }
        .btn-action { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 18px; font-weight: 700; font-size: 1rem; cursor: pointer; box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3); }

        .tx-card { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: var(--glass); border-radius: 20px; margin-bottom: 10px; border: 1px solid rgba(255,255,255,0.03); }
        .tx-actions { display: flex; gap: 18px; color: var(--sub); font-size: 1.1rem; }

        /* --- PREMIUN FLOATING BOTTOM NAV --- */
        .nav-bar { 
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); 
            width: calc(100% - 40px); max-width: 440px;
            background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(25px); 
            border-radius: 35px; display: flex; justify-content: space-around; 
            padding: 10px 8px; border: 1px solid rgba(255,255,255,0.1); 
            z-index: 1000; box-shadow: 0 15px 35px rgba(0,0,0,0.6);
        }
        .nav-item { 
            position: relative; flex: 1; border: none; background: none; 
            color: var(--sub); display: flex; flex-direction: column; 
            align-items: center; gap: 4px; font-size: 0.65rem; 
            cursor: pointer; padding: 8px 0; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .nav-item i { font-size: 1.3rem; transition: transform 0.3s ease; }
        
        /* Active State with Pill Background */
        .nav-item.active { color: #fff; }
        .nav-item.active::before {
            content: ''; position: absolute; top: 0; bottom: 0; left: 10%; right: 10%;
            background: var(--primary); border-radius: 25px; z-index: -1;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
            animation: pillScale 0.3s ease-out;
        }
        .nav-item.active i { transform: translateY(-2px); }
        .nav-item.active span { font-weight: 700; }

        @keyframes pillScale { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }

        .view { display: none; }
        .view.active { display: block; animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        #share-img { width: 100%; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 15px; }
        #canvas-hidden { display: none; }
        .bar-wrap { width: 100%; background: rgba(255,255,255,0.05); height: 8px; border-radius: 4px; margin-top: 6px; overflow: hidden; }
        .bar-fill { background: var(--primary); height: 100%; width: 0%; transition: 1s ease; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="pin-screen">
    <i class="fa-solid fa-user-shield" style="font-size: 3.5rem; color: var(--primary); margin-bottom: 25px;"></i>
    <div class="pin-dots"><div class="pin-dot" id="dot-0"></div><div class="pin-dot" id="dot-1"></div><div class="pin-dot" id="dot-2"></div><div class="pin-dot" id="dot-3"></div></div>
    <div class="numpad">
        <div class="num-btn" onclick="tap(1)">1</div><div class="num-btn" onclick="tap(2)">2</div><div class="num-btn" onclick="tap(3)">3</div>
        <div class="num-btn" onclick="tap(4)">4</div><div class="num-btn" onclick="tap(5)">5</div><div class="num-btn" onclick="tap(6)">6</div>
        <div class="num-btn" onclick="tap(7)">7</div><div class="num-btn" onclick="tap(8)">8</div><div class="num-btn" onclick="tap(9)">9</div>
        <div class="num-btn" onclick="tap('C')"><i class="fa-solid fa-backspace"></i></div>
        <div class="num-btn" onclick="tap(0)">0</div>
        <div class="num-btn" onclick="location.reload()"><i class="fa-solid fa-sync"></i></div>
    </div>
</div>

<div class="app-container">
    <div class="sticky-filter">
        <div class="glass-card" style="padding: 12px; margin-bottom: 0;">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px;">
                <input type="date" id="g-start" onchange="updateAll()">
                <input type="date" id="g-end" onchange="updateAll()">
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px; margin-top:5px;">
                <select id="g-cat" onchange="updateAll()"></select>
                <select id="g-wallet" onchange="updateAll()">
                    <option value="all">ທຸກກະເປົາ</option>
                    <option value="Bank">Bank (ໂອນ)</option>
                    <option value="Cash">Cash (ສົດ)</option>
                </select>
            </div>
        </div>
    </div>

    <div class="header-card">
        <small style="font-size:0.65rem; color:var(--sub); letter-spacing:1px; font-weight:700;">ຍອດເຫຼືອຕາມ FILTER</small>
        <div class="bal-val" id="f-balance">0 ₭</div>
        <div style="display:flex; justify-content:space-around; font-size:0.75rem;">
            <span style="color:var(--income)">ຮັບ: <b id="f-recv">0</b></span>
            <span style="color:var(--expense)">ຈ່າຍ: <b id="f-spent">0</b></span>
        </div>
    </div>

    <div id="v-add" class="view active">
        <div class="glass-card">
            <div class="card-header" id="form-title"><i class="fa-solid fa-circle-plus"></i> ບັນທຶກໃໝ່</div>
            <div class="type-pill">
                <button id="m-exp" class="t-btn active-exp" onclick="setMode('expense')">ລາຍຈ່າຍ</button>
                <button id="m-inc" class="t-btn" onclick="setMode('income')">ລາຍຮັບ</button>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1.2fr; gap:10px;">
                <input type="date" id="i-date">
                <select id="i-wallet"><option value="Bank" selected>Bank (ໂອນ)</option><option value="Cash">Cash (ສົດ)</option></select>
            </div>
            <select id="i-cat"></select>
            <input type="text" id="i-amt" inputmode="decimal" placeholder="0 ₭" oninput="fNum(this)" style="text-align:center; font-size:1.5rem; color:var(--primary); font-weight:700;">
            <input type="text" id="i-note" placeholder="ໝາຍເຫດ...">
            <button class="btn-action" id="btn-save" onclick="save()">ບັນທຶກຂໍ້ມູນ</button>
            <button class="btn-action hidden" id="btn-cancel" style="background:#444; margin-top:10px;" onclick="cancelEdit()">ຍົກເລີກ</button>
        </div>
        <div id="history-list"></div>
    </div>

    <div id="v-report" class="view">
        <div class="glass-card">
            <div class="card-header"><i class="fa-solid fa-chart-pie"></i> ລາຍຈ່າຍໝວດໝູ່ (Filtered)</div>
            <div id="cat-bars-render"></div>
        </div>
    </div>

    <div id="v-share" class="view">
        <div class="glass-card" style="text-align:center;">
            <div class="card-header"><i class="fa-solid fa-share-nodes"></i> ແບ່ງປັນລາຍງານ</div>
            <canvas id="canvas-hidden" width="600" height="950"></canvas>
            <img id="share-img" alt="Summary Image">
            <button class="btn-action" onclick="shareNative()" style="background:var(--primary); margin-bottom:10px;"><i class="fa-solid fa-paper-plane"></i> Share ເຂົ້າ WhatsApp/App ອື່ນ</button>
            <button class="btn-action" onclick="downloadImg()" style="background:var(--glass); font-size:0.8rem;"><i class="fa-solid fa-download"></i> ດາວໂຫລດຮູບ</button>
        </div>
    </div>

    <div id="v-settings" class="view">
        <div class="glass-card">
            <div class="card-header">ຈັດການໝວດໝູ່</div>
            <div style="display:flex; gap:8px;">
                <input type="text" id="n-cat" placeholder="ເພີ່ມ..." style="margin:0;">
                <button onclick="addC()" style="width:60px; border-radius:12px; border:none; background:var(--primary); color:white;">+</button>
            </div>
            <div id="cat-list-edit" style="margin-top:15px;"></div>
        </div>
        <div class="glass-card">
            <button class="btn-action" style="background:#334155; margin-bottom:12px;" onclick="exportData()"><i class="fa-solid fa-file-export"></i> Backup (JSON)</button>
            <input type="file" id="f-import" class="hidden" onchange="importData(event)">
            <button class="btn-action" style="background:#475569; margin-bottom:12px;" onclick="document.getElementById('f-import').click()"><i class="fa-solid fa-file-import"></i> Import</button>
            <button class="btn-action" style="background:var(--expense);" onclick="resetPIN()">Reset PIN</button>
            <button class="btn-action" style="background:#7f1d1d; margin-top:12px;" onclick="clearAll()">ລຶບທຸກຢ່າງ</button>
        </div>
    </div>

    <nav class="nav-bar">
        <button class="nav-item active" onclick="nav('add', this)"><i class="fa-solid fa-house-chimney"></i><span>Home</span></button>
        <button class="nav-item" onclick="nav('report', this)"><i class="fa-solid fa-chart-column"></i><span>Report</span></button>
        <button class="nav-item" onclick="nav('share', this)"><i class="fa-solid fa-bolt"></i><span>Share</span></button>
        <button class="nav-item" onclick="nav('settings', this)"><i class="fa-solid fa-ellipsis"></i><span>Menu</span></button>
    </nav>
</div>

<script>
    const KEY = 'LUXE_MASTER_DATABASE_2026';
    let db = JSON.parse(localStorage.getItem(KEY)) || {
        records: [], cats: ['ອາຫານ', 'ນ້ຳມັນ', 'ເງິນເດືອນ', 'ຄ່າຫ້ອງ', 'ຊື້ເຄື່ອງ'], pin: null, m: 'expense'
    };

    let pIn = "";
    let editId = null;
    document.getElementById('i-date').valueAsDate = new Date();
    document.getElementById('g-start').valueAsDate = new Date(new Date().getFullYear(), new Date().getMonth(), 1);
    document.getElementById('g-end').valueAsDate = new Date();

    function tap(n) {
        if(n==='C') pIn = ""; else if(pIn.length < 4) pIn += n;
        document.querySelectorAll('.pin-dot').forEach((d, i) => d.classList.toggle('active', i < pIn.length));
        if(pIn.length === 4) {
            setTimeout(() => {
                if(!db.pin) { db.pin = pIn; saveDB(); document.getElementById('pin-screen').style.display='none'; }
                else if(pIn === db.pin) document.getElementById('pin-screen').style.display='none';
                else { alert("PIN ຜິດ!"); pIn=""; tap('C'); }
            }, 200);
        }
    }

    function nav(v, el) {
        document.querySelectorAll('.view').forEach(x => x.classList.remove('active'));
        document.getElementById('v-'+v).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));
        el.classList.add('active');
        updateAll();
    }

    function fNum(el) {
        let v = el.value.replace(/,/g, '');
        if(!isNaN(v) && v!=="") el.value = Number(v).toLocaleString();
    }

    function setMode(mode) {
        db.m = mode;
        document.getElementById('m-exp').className = (mode === 'expense') ? 't-btn active-exp' : 't-btn';
        document.getElementById('m-inc').className = (mode === 'income') ? 't-btn active-inc' : 't-btn';
    }

    function saveDB() { localStorage.setItem(DB_KEY, JSON.stringify(db)); updateAll(); }

    function save() {
        const val = document.getElementById('i-amt').value.replace(/,/g, '');
        const amt = parseFloat(val);
        if(!amt) return alert("ປ້ອນເງິນ!");
        const rec = { id: editId || Date.now(), type: db.m, amt, note: document.getElementById('i-note').value, cat: document.getElementById('i-cat').value, date: document.getElementById('i-date').value, wallet: document.getElementById('i-wallet').value };
        if(editId) { db.records = db.records.map(r => r.id === editId ? rec : r); editId = null; }
        else { db.records.unshift(rec); }
        document.getElementById('i-amt').value = ""; document.getElementById('i-note').value = "";
        document.getElementById('btn-save').innerText = "ບັນທຶກຂໍ້ມູນ";
        document.getElementById('btn-cancel').classList.add('hidden');
        saveDB();
    }

    function editR(id) {
        const r = db.records.find(x => x.id === id);
        if(!r) return;
        editId = id;
        setMode(r.type);
        document.getElementById('i-date').value = r.date;
        document.getElementById('i-wallet').value = r.wallet;
        document.getElementById('i-cat').value = r.cat;
        document.getElementById('i-amt').value = r.amt.toLocaleString();
        document.getElementById('i-note').value = r.note;
        document.getElementById('btn-save').innerText = "ອັບເດດລາຍການ";
        document.getElementById('btn-cancel').classList.remove('hidden');
        document.getElementById('form-title').innerHTML = '<i class="fa-solid fa-pen-to-square"></i> ແກ້ໄຂລາຍການ';
        nav('add', document.querySelectorAll('.nav-item')[0]);
    }

    function cancelEdit() { editId = null; document.getElementById('i-amt').value = ""; document.getElementById('btn-save').innerText = "ບັນທຶກຂໍ້ມູນ"; document.getElementById('btn-cancel').classList.add('hidden'); }

    function delR(id) { if(confirm("ລຶບລາຍການນີ້?")) { db.records = db.records.filter(r => r.id !== id); saveDB(); } }

    function updateAll() {
        const start = document.getElementById('g-start').value;
        const end = document.getElementById('g-end').value;
        const cat = document.getElementById('g-cat').value;
        const wal = document.getElementById('g-wallet').value;
        const fil = db.records.filter(r => {
            const mD = (!start || r.date >= start) && (!end || r.date <= end);
            const mC = (cat === 'all' || r.cat === cat);
            const mW = (wal === 'all' || r.wallet === wal);
            return mD && mC && mW;
        });

        let s = 0, r_val = 0;
        fil.forEach(r => { if(r.type==='income') r_val += r.amt; else s += r.amt; });

        document.getElementById('f-balance').innerText = (r_val - s).toLocaleString() + " ₭";
        document.getElementById('f-spent').innerText = s.toLocaleString();
        document.getElementById('f-recv').innerText = r_val.toLocaleString();

        document.getElementById('i-cat').innerHTML = db.cats.map(x => `<option value="${x}">${x}</option>`).join('');
        document.getElementById('g-cat').innerHTML = '<option value="all">ທຸກໝວດໝູ່</option>' + db.cats.map(x => `<option value="${x}">${x}</option>`).join('');

        document.getElementById('history-list').innerHTML = fil.map(r => `
            <div class="tx-card">
                <div style="display:flex; align-items:center; gap:12px;">
                    <div style="width:40px; height:40px; border-radius:12px; background:rgba(${r.type==='income'?'16,185,129':'244,63,94'},0.1); color:var(--${r.type}); display:flex; align-items:center; justify-content:center;"><i class="fa-solid ${r.type==='income'?'fa-plus':'fa-minus'}"></i></div>
                    <div><b>${r.note || r.cat}</b><br><small style="color:var(--sub)">${r.date} • ${r.wallet}</small></div>
                </div>
                <div style="text-align:right">
                    <b style="color:var(--${r.type})">${r.type==='income'?'+':'-'}${r.amt.toLocaleString()}</b>
                    <div class="tx-actions"><i class="fa-solid fa-pen" onclick="editR(${r.id})"></i> <i class="fa-solid fa-trash" onclick="delR(${r.id})"></i></div>
                </div>
            </div>`).join('') || '<p style="text-align:center; color:var(--sub);">ບໍ່ມີຂໍ້ມູນ</p>';

        const cm = {}; fil.filter(r => r.type === 'expense').forEach(r => cm[r.cat] = (cm[r.cat] || 0) + r.amt);
        const sorted = Object.entries(cm).sort((a,b)=>b[1]-a[1]);
        const max = Math.max(...Object.values(cm), 1);
        document.getElementById('cat-bars-render').innerHTML = sorted.map(([k,v]) => `<div style="margin-bottom:12px;"><div style="display:flex; justify-content:space-between; font-size:0.8rem; margin-bottom:5px;"><span>${k}</span><b>${v.toLocaleString()} ₭</b></div><div class="bar-wrap"><div class="bar-fill" style="width:${(v/max)*100}%"></div></div></div>`).join('');

        renderSettings();
        genImage(fil, r_val, s);
    }

    function renderSettings() {
        document.getElementById('cat-list-edit').innerHTML = db.cats.map(c => `<div style="display:flex; justify-content:space-between; padding:10px; background:var(--glass); border-radius:12px; margin-bottom:5px;"><span>${c}</span><span style="color:var(--expense); cursor:pointer;" onclick="delC('${c}')"><i class="fa-solid fa-xmark"></i></span></div>`).join('');
    }

    function importData(ev) {
        const f = ev.target.files[0];
        const r = new FileReader();
        r.onload=(e)=>{
            try {
                db = JSON.parse(e.target.result);
                saveDB(); location.reload();
            } catch(err) { alert("ໄຟລ໌ບໍ່ຖືກຕ້ອງ"); }
        };
        r.readAsText(f);
    }

    function genImage(data, inc, exp) {
        const canvas = document.getElementById('canvas-hidden');
        const ctx = canvas.getContext('2d');
        const cm = {}; data.filter(r => r.type==='expense').forEach(r => cm[r.cat] = (cm[r.cat] || 0) + r.amt);
        ctx.fillStyle = "#0b0f1a"; ctx.fillRect(0, 0, 600, 950);
        ctx.fillStyle = "#6366f1"; ctx.fillRect(0, 0, 600, 200);
        ctx.fillStyle = "#fff"; ctx.font = "bold 40px Arial"; ctx.fillText("Financial Report", 50, 80);
        ctx.fillStyle = "#171b2c";
        if(ctx.roundRect) ctx.roundRect(40, 250, 520, 280, 30); else ctx.fillRect(40, 250, 520, 280);
        ctx.fill();
        ctx.fillStyle = "#fff"; ctx.font = "24px Arial";
        ctx.fillText("Income:", 70, 310); ctx.fillStyle = "#10b981"; ctx.fillText("+ " + inc.toLocaleString(), 340, 310);
        ctx.fillStyle = "#fff"; ctx.fillText("Expense:", 70, 370); ctx.fillStyle = "#f43f5e"; ctx.fillText("- " + exp.toLocaleString(), 340, 370);
        ctx.fillStyle = "#fff"; ctx.font = "bold 32px Arial"; ctx.fillText("Remaining:", 70, 475);
        ctx.fillStyle = "#6366f1"; ctx.fillText((inc - exp).toLocaleString() + " KIP", 300, 475);
        document.getElementById('share-img').src = canvas.toDataURL();
    }

    async function shareNative() {
        const canvas = document.getElementById('canvas-hidden');
        canvas.toBlob(async (blob) => {
            const file = new File([blob], 'report.png', { type: 'image/png' });
            if (navigator.share) {
                try {
                    await navigator.share({ files: [file], title: 'Luxe Money Report' });
                } catch (err) { console.log(err); }
            } else { alert("Browser ບໍ່ຮອງຮັບການ Share ໂດຍກົງ. ໃຫ້ກົດປຸ່ມ Download ແທນ."); }
        });
    }

    function downloadImg() { const a = document.createElement('a'); a.download = 'report.png'; a.href = document.getElementById('canvas-hidden').toDataURL(); a.click(); }
    function addC() { const n = document.getElementById('n-cat').value.trim(); if(n && !db.cats.includes(n)) { db.cats.push(n); document.getElementById('n-cat').value=""; saveDB(); } }
    function delC(n) { if(confirm(`ລຶບໝວດໝູ່ "${n}"?`)) { db.cats = db.cats.filter(x => x !== n); saveDB(); } }
    function exportData() { const a = document.createElement('a'); a.href = URL.createObjectURL(new Blob([JSON.stringify(db)], {type:'application/json'})); a.download="money_backup.json"; a.click(); }
    function clearAll() { if(confirm("ລຶບຂໍ້ມູນທັງໝົດ?")) { localStorage.removeItem(KEY); location.reload(); } }
    function resetPIN() { if(confirm("ປ່ຽນ PIN ໃໝ່?")) { db.pin = null; saveDB(); location.reload(); } }

    if(db.pin) document.getElementById('pin-screen').style.display = 'flex';
    updateAll();
</script>
</body>
</html>